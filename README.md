# Документация для Telegram-бота "Control Bot"

Этот Telegram-бот разработан для удаленного управления сервером, предоставления информации о системе, а также интеграции с Яндекс.Музыкой.

## Установка и Настройка

### 1. Переменные окружения и токены

Перед запуском бота необходимо настроить следующие параметры в файле `control_bot.py`:

* **Токен Telegram-бота (`TELEGRAM_BOT_TOKEN`)**:
    Замените заполнитель на ваш реальный токен бота, полученный от BotFather.
* **Разрешенные ID пользователей (`ALLOWED_USER_IDS`)**:
    Укажите список Telegram User ID, которым будет разрешен доступ к командам бота. Это критически важно для безопасности.
    Пример: `ALLOWED_USER_IDS = [123456789, 987654321]`
* **Токен Яндекс.Музыки (`YANDEX_MUSIC_TOKEN`)**:
    Для использования функций Яндекс.Музыки вам потребуется токен. Инструкцию по его получению можно найти по ссылке: [Инструкция по получению токена Яндекс.Музыки](https://github.com/MarshalX/yandex-music-api/discussions/513#discussioncomment-2729781).
* **Директория для файлов Telegram (`TELEGRAM_FILES_DIR`)**:
    Укажите путь, куда будут сохраняться файлы, отправленные боту через Telegram. По умолчанию: `~/utilites/tg_files/`.

### 2. Зависимости

Бот использует следующие библиотеки Python:
* `python-telegram-bot`
* `yandex_music`
* `aiohttp`

Их можно установить с помощью `pip`.

### 3. Запуск бота

Для запуска бота выполните основной файл `control_bot.py`.

## Функционал и Команды

Бот поддерживает как прямые команды в чате, так и inline-запросы.

### Команды в чате

* `/start`
    Отправляет приветственное сообщение и краткую справку о командах.
* `/terminal [команда]` или `/t [команда]`
    Выполняет указанную команду в терминале сервера и возвращает вывод.
    Примеры:
    * `/t ls -la`
    * `/terminal df -h`
    Для команд `reboot` и `shutdown` требуется дополнительное подтверждение через inline-кнопки для предотвращения случайного выполнения.
* `/status`
    Отображает текущий статус системы, включая информацию об операционной системе, названии сети и локальном IP-адресе.
* `/send [путь до файла]`
    Отправляет указанный файл с сервера пользователю. Файлы, отправленные пользователем боту, сохраняются в директории, указанной в `TELEGRAM_FILES_DIR`.
* `/ymnow`
    Показывает информацию о текущем воспроизводимом треке в Яндекс.Музыке (исполнитель, название, длительность).
* `/ylyrics`
    Получает и отображает текст текущего трека из Яндекс.Музыки.
* `/ylike`
    Добавляет текущий трек из Яндекс.Музыки в "лайкнутые".
* `/ydislike`
    Удаляет текущий трек из "лайкнутых" в Яндекс.Музыке.

### Inline-режим

Вы можете взаимодействовать с ботом в любом чате Telegram, используя его юзернейм (например, `@вашБотЮзернейм`).

* `@вашБотЮзернейм t [команда]`
    Выполняет команду терминала. Команды `reboot` и `shutdown` запрещены в inline-режиме из соображений безопасности.
* `@вашБотЮзернейм ymnow`
    Отображает текущий трек Яндекс.Музыки.
* `@вашБотЮзернейм ylyrics`
    Отображает текст текущего трека Яндекс.Музыки.
* `@вашБотЮзернейм ylike`
    Лайкает текущий трек Яндекс.Музыки.
* `@вашБотЮзернейм ydislike`
    Дизлайкает текущий трек Яндекс.Музыки.

## Обработка файлов

Бот может получать файлы от пользователей. Все отправленные документы или аудиофайлы будут сохранены в директории, указанной в `TELEGRAM_FILES_DIR`.

## Логирование

Бот настроен на базовое логирование активности, ошибок и предупреждений в консоль.

## Безопасность

* **Контроль доступа**: Доступ к командам бота строго ограничен списком `ALLOWED_USER_IDS`. Убедитесь, что этот список содержит только доверенные Telegram User ID.
* **Подтверждение критических команд**: Команды `reboot` и `shutdown` требуют явного подтверждения от пользователя через интерактивные кнопки, чтобы предотвратить случайное выключение или перезагрузку системы.
* **Ограничение inline-команд**: Команды `reboot` и `shutdown` запрещены в inline-режиме.
